# Unsupervised-sleep-scoring

This code was for a ferret sleep project, that was published in Scientific Reports. 
The paper can be found here: https://www.nature.com/articles/s41598-017-08050-6

The basic premise of this work was to take electrocorticographic signals from sleeping ferrets and design an algorithm to decode which stage of wakefulness or sleep animals were in at each moment in time. Below are the relevant sections of the methods section from the paper that describe how to first train the classifier on an example datasset (is_computePCA.m), and then use this algorithm to classify unseen data (is_classifyState.m)

To control for drifting and movement related artifacts, the global average signal across the entire µECoG grid was subtracted from each LFP time series. Noise epochs were detected using a threshold of 10 standard deviations. Data were rejected in a window of ± 10 seconds from all time points that exceeded this threshold. To compute time-resolved spectra, LFP signals were convolved with a series of 80 logarithmically spaced Morlet wavelets spanning frequencies 0.3–100 Hz. Spectral power was then computed by taking the square of the absolute value of time frequency estimates in the time domain. LFP spectrograms were then smoothed in the time domain using a Gaussian kernel of one-minute width (for comparison of smoothed and raw spectra PCA, see Supplementary Figure 1).

To project time-varying spectral properties into state space, we first z-scored the analytic amplitude of µECoG signals over time to normalize amplitude fluctuations across all frequencies (Fig. 2A, right). Principal component analysis was then performed on the z-scored amplitude matrix. The principal components that collectively explained more than 80 % of variance in spectra were used to construct the brain state space. Inspection of the principal component eigenvector coefficients as a function of LFP frequency revealed that principal components captured information spanning all frequency bands (Fig. 2C). To compute trajectories in state space we first took the first derivative of principal component time series to acquire the rate of change across each state space axis. Then the derivatives of the first two principal components were combined to generate state space velocity vectors for each data sample. Velocity vectors were binned according to location in state space, and the mean state space velocity vector for each bin was computed. Finally, mean velocity vectors were overlaid as topological ‘quiver’ plots on state space plots, where the direction and length of vectors indicate direction and rate of change through state space (for example, Fig. 3D).

To compute the optimal number of clusters across brain state space, we performed k-means cluster analysis assuming between 2 to 8 clusters (Fig. 3A). The optimal number of clusters was defined by computing the squared Euclidean distance between resultant data clusters. For each recording session, data from one electrode placed over visual cortical area 21 was used to project time-varying spectral properties into state space. To account for variance in clustering results based on differing initial cluster estimates, we repeated k-means clustering 100 times and took the most common cluster assignment for each data point.
